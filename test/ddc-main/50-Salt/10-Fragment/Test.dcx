-- Check for fragment violations.
-- The errors come from the Salt -> C or Salt -> LLVM conversion.
:set +SuppressImports
:set lang Salt


-- Error: Unknown primop.
:check foo#


-- Error: Module does not have a top-level letrec.
:to-c..
module Main with let
x = 5#;;


-- Ok: Function finishes with a return statement.
:to-c..
module Main with letrec
foo (x : Int#) : Int#   
 = return# [Int#] x;;


-- Ok: Statements in function.
:to-c..
module Main with letrec 
foo (x : Int#) : Int#
 = let  y       = add# [Int#]  x x
   in   return# [Int#] y;;


-- Ok: Function explicitly fails.
:to-c..
module Main with letrec
foo (x : Int#) : Int#
 = let  y       = add# [Int#]  x x
   in   fail# [Int#];;


-- Ok: assignment between variables.
:to-c..
module Main with letrec
foo (x : Int#) : Int#
 = let y        = x
   in  return# [Int#] y;;


-- Ok: assignment from a literal.
:to-c..
module Main with letrec
foo (x : Nat#) : Nat#
 = let  y       = 5#
   in   return# [Nat#] y;;


-- Error: assignment from primop.
:to-c..
module Main with letrec
foo (x : Int#) : Int#
 = let y        = add#
   in  return# [Int#] x;;
