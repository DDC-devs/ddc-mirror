
:set lang Lite
:set +Indent +SuppressImports
:set builder x86_64-darwin


-- Boxed addition
:to-llvm..
module Test with letrec
addInt [r1 r2 r3 : %] 
        (x : Int r1) { !0 | Use r3 } 
        (y : Int r2) { Read r1 + Read r2 + Alloc r3 | Use r1 + Use r3}
        : Int r3
 =  case x of { I# i1 
 -> case y of { I# i2 
 -> I# [r3] (add# [Int#] i1 i2) } };;


-- None binders.
:to-llvm..
module Test with letrec
thing [r1 : %] (z : Unit) { Alloc r1 | Use r1 } : Unit
 = do   _       = N# [r1] 5#
        ();;


-- BROKEN: CAF binder.
--module Test with letrec
--thing [r1 : %] : Unit
-- = do   x       = N# [r1] 5#
--        x;;
