:set SuppressLetTypes

-- | Single map over input series, producing a vector.
:flow-lower..
module Test with letrec
test [k : Rate] (s : Series# k Int#) : Vector# Int#
 = screate# [k] [Int#]
        (smap# [k] [Int#] [Int#]
                (\(x : Int#). add# [Int#] (mul# [Int#] x 2i#) 1i#) s)
;;


-- | Single map over input series, writing into existing vector.
:flow-lower..
module Test with letrec
test    [k : Rate] 
        (v : Vector# Int#) (s : Series# k Int#) 
        : Int#
 = do   sfill# [k] [Int#] v
                (smap# [k] [Int#] [Int#]
                        (\(x : Int#). add# [Int#] (mul# [Int#] x 2i#) 1i#) s)

        sfold# [k] [Int#] [Int#] (add# [Int#]) 0i# s
;;
