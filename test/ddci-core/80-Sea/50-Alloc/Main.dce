
module Runtime with letrec {


allocRaw (tag : Tag#) (sizePayload : Nat#) : Ptr# Obj
 = do { sizeObj = add# [Nat#] 8 sizePayload;
        addr    = alloc# sizeObj;
        tag'    = promote# [Word32#] [Tag#] tag;
        format  = 42w32#;
        header  = bor# [Word32#] (shl# [Word32#] tag' 8w32#) format;
        return# [Ptr# Obj] (makePtr# [Obj] addr);
     };
};

--      writeAt [Word32#] addr   header;
--      writeAt [Word32#] addr 4 sizePayload;
