-- Check for fragment violations.
:set +Indent
:set lang Sea


-- Error: Unknown primop.
:check foo#


-- Error: Module does not have a top-level letrec.
:sea..
module Main with let
x = 5;;


-- Ok: Function finishes with a return statement.
:sea..
module Main with letrec
foo (x : Int32#) : Int32#   
 = return# [Int32#] x;;


-- Error: Function does not pass control.
:sea..
module Main with letrec 
foo (x : Int32#) : Int32#   
 = x;;


-- Ok: Statements in function.
:sea..
module Main with letrec 
foo (x : Int32#) : Int32#
 = let  y       = add# [Int32#]  x x
   in   return# [Int32#] y;;


-- Error: Function does not pass control
:sea..
module Main with letrec 
foo (x : Int32#) : Int32#
 = let  y       = add# [Int32#]  x x
   in   add# [Int32#] y y;;


-- Error: Function does not pass control
:sea..
module Main with letrec
foo (x : Int32#) : Bool#
 = let  y       = add# [Int32#]  x x
   in   True#;;


-- Ok: Function explicitly fails.
:sea..
module Main with letrec
foo (x : Int32#) : Int32#
 = let  y       = add# [Int32#]  x x
   in   fail# [Int32#];;


-- Ok: assignment between variables.
:sea..
module Main with letrec
foo (x : Int32#) : Int32#
 = let y        = x
   in  return# [Int32#] y;;


-- Ok: assignment from a literal.
:sea..
module Main with letrec
foo (x : Nat#) : Nat#
 = let  y       = 5
   in   return# [Nat#] y;;


-- Error: assignment from primop.
:sea..
module Main with letrec
foo (x : Int32#) : Int32#
 = let y        = add#
   in  return# [Int32#] x;;


-- Error: cannot discard non-void return value.
:sea..
module Main with letrec
foo (x : Int32#) : Int32#
 = let _        = x
   in  return# [Int32#] x;;
